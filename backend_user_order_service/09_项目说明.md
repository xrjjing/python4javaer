# 后端用户与订单示例服务（backend_user_order_service）说明

## 一、项目定位

- 该服务作为 `integration_gateway_service` 的下游示例后端服务；
- 使用 FastAPI 编写，提供简单的用户查询和订单创建接口；
- 目的是让你可以在本仓库内部就完成“网关 -> 后端服务”的完整调用闭环，
  而不依赖外部 Java 服务或其他语言技术栈。

## 二、目录结构

- `backend_user_order_service/app/`
  - `__init__.py`：应用包初始化。
  - `main.py`：FastAPI 入口，实现用户与订单接口。
  - `schemas.py`：Pydantic 模型定义（用户信息、订单创建与返回结构）。

## 三、运行方式

1. 安装依赖（需在仓库根目录）：

   ```bash
   pip install -r requirements.txt
   ```

2. 启动后端服务（建议使用 9000 端口，与网关默认配置一致）：

   ```bash
   uvicorn backend_user_order_service.app.main:app --reload --port 9000
   ```

3. 访问文档页面：

   - 本地默认地址：`http://127.0.0.1:9000/docs`

## 四、提供的接口

1. `GET /api/users/{user_id}`

   - 功能：根据用户 ID 查询用户信息；
   - 返回：`UserOut` 模型，包含 `id`、`username`、`full_name`；
   - 示例内置用户：
     - `1 -> alice`
     - `2 -> bob`

2. `POST /api/orders`

   - 功能：创建订单；
   - 入参：`OrderCreateIn`（`user_id`、`product_id`、`quantity`）；
   - 返回：`OrderOut`，包含 `order_id`、`status`、`message`、`created_at`；
   - 为简化示例，订单使用自增 ID，不做持久化存储。

## 五、与网关服务的配合

- 网关服务 `integration_gateway_service` 默认的 `backend_service_base_url`
  为 `http://localhost:9000`，与本服务端口设置一致；
- 网关中的 `/gateway/backend/users/{user_id}` 与 `/gateway/backend/orders`
  会通过 HTTP 调用本服务的 `/api/users/{user_id}` 和 `/api/orders` 接口；
- 建议的本地联调步骤：
  1. 启动 RBAC 服务，初始化用户并获取 JWT；
  2. 启动本后端服务（端口 9000）；
  3. 启动网关服务（端口 8000，必要时配置 `GATEWAY_BACKEND_SERVICE_BASE_URL`）；
  4. 使用从 RBAC 获取的 Token，调用网关接口，观察请求是否正确转发到本服务。

