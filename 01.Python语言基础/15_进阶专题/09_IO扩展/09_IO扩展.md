# 09_IO 扩展：内存流、二进制解析与压缩

> 目标：掌握内存文件（StringIO/BytesIO）、二进制结构解析（struct）以及常见压缩格式（gzip/zipfile）的基础用法。

## 1. 内存文件：StringIO / BytesIO

```python
from io import StringIO, BytesIO

# 文本流
buf = StringIO()
buf.write("hello\n")
buf.write("world")
print(buf.getvalue())

# 字节流
bbuf = BytesIO()
bbuf.write(b"hello")
print(bbuf.getvalue())  # b'hello'
```

场景：
- 将字符串当作文件处理（单测、临时拼装配置）。
- Web/文件接口的内存缓存，避免临时落盘。

## 2. struct：二进制打包/解包

```python
import struct

data = struct.pack('<Ihf', 0x12345678, -1, 3.14)
# < 小端；I 无符号32位；h 有符号16位；f 浮点
print(data)  # b'\x78V4\x12\xff\xff\xc3@'

uid, flag, score = struct.unpack('<Ihf', data)
print(uid, flag, score)
```

场景：网络协议、文件头解析、与 C/Java 通信时的二进制格式。

## 3. gzip / zipfile：压缩与归档

```python
import gzip, zipfile, io

# gzip 压缩/解压
text = b"hello gzip" * 10
compressed = gzip.compress(text)
decompressed = gzip.decompress(compressed)

# zipfile 创建与读取（内存流示例）
buf = io.BytesIO()
with zipfile.ZipFile(buf, 'w', compression=zipfile.ZIP_DEFLATED) as zf:
    zf.writestr('hello.txt', '你好，zip!')

buf.seek(0)
with zipfile.ZipFile(buf, 'r') as zf:
    print(zf.namelist())
    print(zf.read('hello.txt').decode())
```

场景：日志归档、接口压缩传输、在内存中生成/读取压缩包（避免磁盘 IO）。

## 4. 与本仓库的联系
- `03.项目实战/06_自动化脚本_日志归档` 可使用 gzip/zipfile 将日志按日期归档。
- 网关/日志侦探的测试数据可用 BytesIO 构造伪文件，避免临时文件。
- 若与其他语言交互二进制协议，可用 struct 按协议字段顺序 pack/unpack。

## 5. 配套示例
- 运行：`python 01.Python语言基础/15_进阶专题/09_IO扩展/demo_io_ext.py`
- 内容：StringIO/BytesIO、struct、gzip/zipfile 全流程演示。
