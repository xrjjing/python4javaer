# 05_序列与集合类型

## 学习目标

- 熟悉 `list`、`tuple`、`dict`、`set` 的基本用法
- 掌握常见操作：增删改查、遍历、切片
- 初步使用列表推导式和字典推导式

---

## 知识点清单

- 列表 `list`：可变有序序列
- 元组 `tuple`：不可变有序序列
- 字典 `dict`：键值对映射
- 集合 `set`：不重复元素的无序集合
- 常见方法：`append`、`pop`、`keys`、`values`、`items` 等
- 切片：`seq[start:end:step]`
- 推导式：

  ```python
  squares = [x * x for x in range(10)]
  even_mapping = {x: x * 2 for x in range(10) if x % 2 == 0}
  ```

---

## 示例 demo：学生成绩管理（内存版）

```python
# demo_collections.py

students = ["张三", "李四", "王五"]
scores = [85, 92, 78]

# 使用字典绑定姓名和成绩
score_map = {}
for i in range(len(students)):
    score_map[students[i]] = scores[i]

print("成绩映射：", score_map)

# 使用字典推导式实现同样的功能
score_map2 = {name: score for name, score in zip(students, scores)}
print("推导式映射：", score_map2)

# 集合示例：去重
tags = ["python", "java", "python", "golang", "java"]
unique_tags = set(tags)
print("去重后的标签：", unique_tags)
```

---

## 练习题（建议新建 `practice_collections.py` 完成）

1. 定义一个列表，包含 10 个整数，分别计算：
   - 所有元素的和
   - 最大值和最小值
   - 所有偶数构成的新列表（可尝试列表推导式）。
2. 定义一个字典，键为课程名（如 `"Python"`、`"Java"`），值为分数，完成：
   - 输出所有课程名
   - 输出所有分数
   - 计算平均分。
3. 给定一个包含大量邮箱地址的列表，使用集合去重后输出去重后的数量。
4. 思考题：解释 `a = [1, 2, 3]; b = a; b.append(4)` 之后 `a` 和 `b` 的内容各是什么？为什么？

---

## 🎯 开放式挑战

### 挑战 1：词频统计器（初级）

**任务描述**：
编写一个英文文本词频统计工具，实现以下功能：
- 读取文本文件，统计每个单词出现的次数
- 忽略大小写和标点符号
- 输出前 10 个高频词及其出现次数

**示例输入**：
```
Python is great. Python is easy to learn.
Java is also great, but Python is simpler.
```

**预期输出**：
```
python: 3
is: 3
great: 2
java: 1
easy: 1
...
```

**技术要点**：
- 使用字典存储 `{单词: 出现次数}`
- 使用集合处理停用词（the, is, a 等）
- 字典排序：`sorted(dict.items(), key=lambda x: x[1], reverse=True)`

**扩展要求**：
- 支持中文文本（使用 jieba 分词）
- 生成词云图（使用 wordcloud 库）
- 过滤停用词列表

---

### 挑战 2：购物车系统（中级）

**任务描述**：
使用字典和列表实现一个简单的购物车系统。

**功能需求**：
1. 商品管理（字典存储商品信息）
   ```python
   products = {
       'P001': {'name': 'Python 书籍', 'price': 89.0, 'stock': 100},
       'P002': {'name': 'Java 书籍', 'price': 99.0, 'stock': 50}
   }
   ```

2. 购物车操作
   - 添加商品到购物车
   - 修改商品数量
   - 移除商品
   - 查看购物车

3. 订单计算
   - 计算总价
   - 应用折扣（满减、打折）
   - 库存检查与扣减

**核心数据结构**：
```python
cart = {
    'P001': {'quantity': 2, 'subtotal': 178.0},
    'P002': {'quantity': 1, 'subtotal': 99.0}
}
```

**预期难点**：
- 嵌套字典的更新
- 库存不足的异常处理
- 折扣规则的组合计算

**评估标准**：
- 数据结构设计合理
- 边界情况处理完善（负数、库存不足）
- 代码可读性高

---

### 挑战 3：数据去重与合并工具（高级）

**任务描述**：
处理多个数据源的用户数据，实现智能去重与合并。

**场景**：
你从 3 个不同系统获取了用户数据（CSV 格式），需要合并为唯一用户列表。

**示例数据**：
```python
# 系统 A
users_a = [
    {'id': 1, 'name': '张三', 'email': 'zhangsan@example.com'},
    {'id': 2, 'name': '李四', 'email': 'lisi@example.com'}
]

# 系统 B（ID 不同，但邮箱相同）
users_b = [
    {'id': 101, 'name': 'Zhang San', 'email': 'zhangsan@example.com'},
    {'id': 102, 'name': '王五', 'email': 'wangwu@example.com'}
]

# 系统 C（姓名相同，但邮箱不同）
users_c = [
    {'id': 201, 'name': '张三', 'email': 'zhangsan2@company.com'}
]
```

**技术挑战**：
1. **去重策略**
   - 以邮箱为主键去重
   - 处理姓名大小写、空格差异
   - 合并多个系统的 ID（保留所有 ID 列表）

2. **数据结构选择**
   - 使用集合快速检查邮箱是否存在
   - 使用字典 `{email: user_info}` 存储合并结果
   - 嵌套列表存储多个系统 ID

3. **数据合并规则**
   ```python
   # 合并后的期望结果
   merged_users = {
       'zhangsan@example.com': {
           'ids': [1, 101],  # 来自不同系统的 ID
           'names': ['张三', 'Zhang San'],  # 所有出现的姓名变体
           'primary_name': '张三',  # 选择最常见的姓名
           'email': 'zhangsan@example.com'
       }
   }
   ```

**性能要求**：
- 处理 10 万条数据在 1 秒内完成
- 内存占用合理（避免重复存储）

**扩展功能**：
- 支持模糊匹配（姓名相似度 > 80%）
- 生成去重报告（重复数量、合并规则统计）
- 导出为 JSON/CSV 格式

**提示**：
- 使用 `collections.defaultdict` 简化嵌套字典操作
- 使用 `collections.Counter` 统计姓名出现频率
- 考虑使用 `set` 操作加速邮箱查找

