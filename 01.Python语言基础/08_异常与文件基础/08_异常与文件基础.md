# 08_异常与文件基础

## 学习目标

- 理解异常的概念与常见异常类型
- 会用 `try / except / else / finally` 结构处理异常
- 掌握 `open` / `read` / `write` 的基本用法
- 熟悉 `with` 上下文管理器处理文件

---

## 知识点清单

- 异常捕获：

  ```python
  try:
      ...
  except ValueError as e:
      ...
  else:
      ...
  finally:
      ...
  ```

- 主动抛出异常：`raise ValueError("错误信息")`
- 文件操作模式：`"r"`（读）、`"w"`（写）、`"a"`（追加）、`"rb"` / `"wb"`（二进制）
- `with` 语句自动关闭文件：

  ```python
  with open("data.txt", "r", encoding="utf-8") as f:
      content = f.read()
  ```

---

## 示例 demo：从文件读取数字求和

```python
# demo_file_exception.py

def read_numbers(path: str) -> list[int]:
    numbers: list[int] = []
    with open(path, "r", encoding="utf-8") as f:
        for line in f:
            line = line.strip()
            if not line:
                continue
            try:
                num = int(line)
            except ValueError:
                print("跳过非法行：", line)
            else:
                numbers.append(num)
    return numbers


def main():
    path = "numbers.txt"
    nums = read_numbers(path)
    print("读取到的数字：", nums)
    print("总和：", sum(nums))


if __name__ == "__main__":
    main()
```

> 使用时可以先创建一个 `numbers.txt` 文件，每行写一个整数，再运行该脚本。

---

## 练习题（建议新建 `practice_file_exception.py` 完成）

1. 编写程序，从用户输入的文件路径读取内容，如果文件不存在，捕获异常并提示「文件不存在」。  
2. 编写程序，将若干行文本写入文件 `output.txt`，每行前面加上行号，例如：  
   `1: 第一行内容`  
   `2: 第二行内容`  
3. 将第 4 章中的「猜数字游戏」中的输入转换为整数时加入异常处理：  
   - 当用户输入不是数字时，不要退出程序，而是提示「请输入数字」。  
4. 思考题：为什么建议总是使用 `with open(...) as f:` 的写法，而不是手动 `f = open(...); f.close()`？

