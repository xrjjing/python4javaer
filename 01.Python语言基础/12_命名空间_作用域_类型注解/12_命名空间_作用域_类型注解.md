# 12_命名空间_作用域_类型注解

> 本章是对函数、模块和变量的补充，对 Java 开发者非常重要，有助于写出更清晰、更易维护的 Python 代码。

## 学习目标

- 理解「命名空间」「作用域」的概念
- 知道局部变量、全局变量、内建变量的区别
- 理解基本的类型注解（type hints），会为函数和变量添加类型标注

---

## 知识点清单

### 1. 命名空间与作用域

- 命名空间：名称到对象的映射，例如：局部命名空间、全局命名空间、内建命名空间。
- 作用域（LEGB 规则）：
  - L：Local（函数内部）
  - E：Enclosing（嵌套函数外层）
  - G：Global（模块级）
  - B：Built-in（内建）
- `global` 与 `nonlocal` 关键词：修改外层作用域中的变量。

```python
# demo_scope.py

x = 10  # 全局变量


def outer():
    x = 20  # 外层函数的局部变量

    def inner():
        nonlocal x
        x = 30
        print("inner:", x)

    inner()
    print("outer:", x)


if __name__ == "__main__":
    outer()
    print("global:", x)
```

### 2. 类型注解（type hints）

- Python 是动态类型语言，但可以通过类型注解和工具（如 `mypy`）做静态检查。
- 基本写法：

  ```python
  age: int = 18
  name: str = "Tom"

  def add(a: int, b: int) -> int:
      return a + b
  ```

- 容器类型（推荐使用 `typing` 模块中的类型）：

  ```python
  from typing import List, Dict

  nums: List[int] = [1, 2, 3]
  mapping: Dict[str, int] = {"a": 1, "b": 2}
  ```

---

## 示例 demo：类型注解与 `mypy` 初体验

```python
# demo_type_hints.py

from typing import List


def average(nums: List[float]) -> float:
    if not nums:
        raise ValueError("nums 不能为空")
    return sum(nums) / len(nums)


if __name__ == "__main__":
    data = [1.0, 2.5, 3.5]
    print("平均值：", average(data))
```

> 如果你本地安装了 `mypy`，可以在命令行运行 `mypy demo_type_hints.py` 体验类型检查。

---

## 练习题（建议新建 `practice_scope_type_hints.py` 完成）

1. 写一段代码，演示局部变量和全局变量同名时，分别在函数内外 `print` 的值有何不同。  
2. 编写函数 `find_max(nums: list[int]) -> int`，返回列表中的最大值，列表为空时抛出 `ValueError`。  
3. 修改你之前写过的任意一个函数，为它增加合适的类型注解，并运行确保仍然正常工作。  
4. 思考题：在动态语言中加入类型注解有什么好处和成本？结合你写过的 Java 代码谈谈你的理解。

