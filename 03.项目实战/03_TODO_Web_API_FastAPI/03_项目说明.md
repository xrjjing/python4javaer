# 03_TODO_Web_API_FastAPI

> 目标：使用 FastAPI 实现一个「待办事项（TODO）」管理 REST API，从内存版逐步升级到 SQLite + SQLAlchemy 持久化版本。

## 阶段一：内存版 TODO API（概念理解）

这一阶段你可以先参考 `03.项目实战/03.项目实战.md` 中给出的简化示例，
实现一个仅使用内存列表存储数据的 TODO API，练习以下内容：

- FastAPI 应用入口与路由；
- GET / POST / PUT / DELETE 的基本写法；
- Pydantic 模型作为请求与响应体。

> 建议：自己新建一个 `main_memory.py`，亲手把「内存版」写一遍。

## 阶段二：SQLite + SQLAlchemy 持久化版本

本目录下的 `app/` 代码实现了一个使用 SQLite 数据库的 TODO API，结构参考了社区常见的
FastAPI 教程与开源项目的最佳实践（如将 `models`、`schemas`、`routers` 拆分）。  
你学习时可以重点关注「代码分层与职责划分」。

### 目录结构

```text
03.项目实战/
└── 03_TODO_Web_API_FastAPI/
    ├── 03_项目说明.md
    └── app/
        ├── __init__.py
        ├── database.py      # 数据库引擎与会话管理
        ├── models.py        # SQLAlchemy ORM 模型
        ├── schemas.py       # Pydantic 数据模型
        ├── main.py          # FastAPI 入口，挂载路由
        └── routers/
            ├── __init__.py
            └── todos.py     # TODO 相关路由
```

### 运行步骤

1. 安装依赖：

   ```bash
   pip install fastapi "uvicorn[standard]" sqlalchemy
   ```

2. 在项目根目录运行服务：

   ```bash
   cd 03.项目实战/03_TODO_Web_API_FastAPI
   uvicorn app.main:app --reload
   ```

3. 在浏览器中访问：

   - `http://127.0.0.1:8000/docs` 打开自动生成的接口文档；
   - 使用 Swagger UI 直接调试增删改查。

### 接口说明（数据库版）

- `GET /todos`：查询全部 TODO；
- `POST /todos`：创建 TODO（请求体包含 `title`，可选 `completed`）；
- `PUT /todos/{id}`：更新 TODO（标题和完成状态可选修改）；
- `DELETE /todos/{id}`：删除 TODO。

## 测试说明

- 本项目有一个基础的接口级测试文件：`test_todo_api.py`。  
- 在仓库根目录运行下面命令可以只跑本项目的测试：

  ```bash
  pytest 03.项目实战/03_TODO_Web_API_FastAPI/test_todo_api.py
  ```

测试特点：

- 使用 FastAPI 官方推荐的 `TestClient`；
- 使用 SQLite 内存数据库（`sqlite:///:memory:`）和依赖注入覆盖 `get_db`，避免污染实际 `todo.db`；
- 测试一个完整的 CRUD 流程：
  - `POST /todos/` 创建 TODO；
  - `GET /todos/` 查询列表；
  - `PUT /todos/{id}` 更新完成状态；
  - `DELETE /todos/{id}` 删除后再次查询确认不再存在。

通过阅读 `test_todo_api.py`，你可以看到「如何在 FastAPI 项目中为接口编写测试」的完整示例，以后可以套用到你自己的 API 项目中。

## 阶段三：可以尝试的进阶方向

当你熟悉阶段二的实现后，可以尝试：

- 为 TODO 增加 `created_at`、`updated_at` 字段，并按创建时间排序；
- 为不同用户区分 TODO（简单做也可以只支持一个硬编码的用户 ID）；
- 将数据库相关配置（数据库文件路径等）抽出到配置模块或环境变量中；
- 为核心逻辑编写 pytest 测试，练习接口测试。

未来如果你想进一步构建更复杂的 FastAPI 项目，可以结合
`02.开发环境及框架介绍` 中的内容以及 GitHub 上的 FastAPI 模板项目，
逐步抽象出属于你自己的项目脚手架。
