# A_写接口_接口开发与网关

> 目标：从零开始掌握用 Python 写接口（Restful API）的完整路径，包括：纯 FastAPI CRUD、与数据库结合、再到作为网关调用 Java 系统的接口。

本分目录主要聚合与「写接口」强相关的实战项目：

- `03_TODO_Web_API_FastAPI`：自己实现 TODO 业务接口；
- `08_系统对接_调用Java服务API`：Python 网关调用 Java 系统。

建议学习顺序如下。

---

## 阶段 A1：FastAPI 基础 CRUD（TODO 项目内存版）

对应项目：`03_TODO_Web_API_FastAPI`（你可以先自己写一个 `main_memory.py`）

- 目标：
  - 掌握 FastAPI 的基本用法：路由、路径参数、查询参数、请求体、响应模型；
  - 实现一个使用「内存列表」存储数据的 TODO 增删改查接口。
- 推荐步骤：
  1. 仔细阅读 `02.开发环境及框架介绍/02.开发环境及框架介绍.md` 中 FastAPI 核心概念部分；
  2. 在 `03_TODO_Web_API_FastAPI` 目录里新建 `main_memory.py`，照文档实现内存版 CRUD；
  3. 通过 `uvicorn` 跑起来，用浏览器 `/docs` 进行测试。

---

## 阶段 A2：FastAPI + SQLite + SQLAlchemy（TODO 项目数据库版）

对应项目：`03_TODO_Web_API_FastAPI/app/`

- 目标：
  - 理解一个「稍微像样一点」的后端 API 项目结构；
  - 掌握 ORM 模型（`models.py`）、Pydantic 模型（`schemas.py`）、路由模块（`routers/todos.py`）、应用入口（`main.py`）的分工。
- 推荐步骤：
  1. 先运行一遍数据库版 TODO：

     ```bash
     pip install fastapi "uvicorn[standard]" sqlalchemy
     cd 03.项目实战/03_TODO_Web_API_FastAPI
     uvicorn app.main:app --reload
     ```

  2. 对照代码阅读：
     - `database.py`：引擎 + 会话管理 + `get_db` 依赖；
     - `models.py`：`Todo` ORM 模型；
     - `schemas.py`：请求/响应用的 Pydantic 模型；
     - `routers/todos.py`：CRUD 路由的具体实现；
     - `main.py`：应用工厂函数、建表和挂载路由。
  3. 在此基础上尝试扩展：
     - 给 TODO 增加 `created_at`、`updated_at` 字段；
     - 按创建时间排序返回；
     - 增加简单的「按完成状态过滤」查询接口。

---

## 阶段 A3：Python 网关调用 Java 服务（对接场景）

对应项目：`08_系统对接_调用Java服务API`

- 目标：
  - 学会把「调用 Java 接口」封装成一个 Python 客户端类；
  - 学会使用 FastAPI 写一个「网关层」，对外暴露统一风格的接口，对内调用 Java 系统；
  - 掌握错误转换、配置管理（base_url）、依赖注入等工程实践。
- 关键文件：
  - `client_java_service.py`：
    - `JavaServiceClient.from_env()`：读取 `JAVA_SERVICE_BASE_URL`；
    - `_handle_response`：统一处理 HTTP 响应与异常；
    - `get_user` / `create_order`：根据你公司实际接口改造。
  - `api_gateway_example.py`：
    - 依赖注入 `get_java_client`；
    - `GET /proxy/users/{user_id}` 与 `POST /proxy/orders` 两个示例接口；
    - 将 `JavaServiceError` 转换为 HTTP 502。

---

## 阶段 A4：进阶建议（可选）

当 A1~A3 完成后，你可以考虑：

- 为 TODO API 和网关 API 写 pytest 测试，用 `TestClient` 调接口；
- 抽象出统一的响应格式，例如：

```json
{
  "code": 0,
  "message": "ok",
  "data": {...}
}
```

- 为接口增加简单的认证机制（如 Header 中传递 token，并在依赖中校验）。

这些内容会进一步拉近你和「日常 Java 后端开发」之间的差距，只是换成了 Python + FastAPI 的写法。
